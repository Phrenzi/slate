<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the Phrenzi API! You can use our API to access Phrenzi API endpoints, which can get
information on various establishments, transactions, and challenges in our database.</p>

<p>We have language bindings in Shell! You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<h1 id="api-version">API Version</h1>

<p>We have only 1 version of API now in Phrenzi,
but we are going to increse the API version in the future if we need to.
So it is better to claim the version of API you are going to call,
by inserting a special header item in every of your request.</p>

<aside class="success">If client do not specify the api version, then server will assume that client want to request latest version of API. </aside>

<blockquote>
<p>To specify the version of API, simply insert a header <code class="prettyprint">ACCEPT</code>, with a value with <code class="prettyprint">phrenzi.v#{version_of_api}</code>, example:</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api_endpoint"</span> <span class="se">\</span>
  -H <span class="s2">"ACCEPT: phrenzi.v1"</span> <span class="se">\</span>
</code></pre>

<h1 id="authentication">Authentication</h1>

<blockquote>
<p>To authorize, use this code:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># With shell, you can just pass the correct header with each request</span>
curl <span class="s2">"api_endpoint_here"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="c"># this tell server to response with json \</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span>
</code></pre>

<blockquote>
<p>auth header here is required, and can be retrieved from header in last api response.</p>
</blockquote>

<p>We take security as a first priority, so following security mechanism is under consider during design API:</p>

<ul>
<li>token is change after every request</li>
<li>all the token we using during exchanged is hashed using BCrypt ( not plain text stored )</li>
<li>we use securely compared ( to protect against timing attacks )</li>
<li>token is invalidate after 2 weeks</li>
</ul>

<h2 id="auth-header">Auth Header</h2>

<p>after authenticate ( for example, sign in api call), the header from api response will have
following 5 tags, we call it <code class="prettyprint">Auth Header</code>, client need to extract out <code class="prettyprint">Auth Header</code>,
and insert it in header of next api call. For a exmaple of Auth Header, please have a look at right hand side.</p>

<p>Noted: Any client can easily extract out this <code class="prettyprint">Auth Header</code> exchange logic into a library and shared it out.</p>

<ul>
<li>access-token</li>
<li>token-type</li>
<li>client</li>
<li>expiry</li>
<li>uid</li>
</ul>

<h1 id="app-token">APP TOKEN</h1>

<p>For some public facing api, like patron sign in, patron sign up, request to reset password,  and manager sign in,</p>

<p>it&rsquo;s better to add basic level protection as well, by predefine App Token, and inserting a
<code class="prettyprint">Authorization</code> header with App Token in your request header for public facing api, we can block anonymous attack.</p>

<p>For the correct App Token, please contact admin of Phrenzi.</p>

<blockquote>
<p>Token Authenticated by insert a <code class="prettyprint">Authorization</code> header in your api request, following example is a call to patron sign in with App Token inserted.</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/patrons/sign_in"</span> <span class="se">\</span>
  -H <span class="s2">"ACCEPT: phrenzi.v1"</span> <span class="se">\</span>
  -H <span class="s2">"Authorization: app_token"</span>
</code></pre>

          <h1 id="json-objects">JSON Objects</h1>

<p>normally, a api response in Phrenzi, will be somehow like this in the right hand side :</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"object_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"object_attribute_a"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABCCDD"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"object_attribute_b"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Simon"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"object_attribute_c"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc@exmaple.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"object_attribute_d"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234.22"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>In <code class="prettyprint">object_name</code> tag, it represent the important part for client to consuming, either a json object, or
Array of json objects. It would be easier for us to classify different json object from Phrenzi api
returned, so we list all the different json object here:</p>

<h2 id="patron">Patron</h2>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&lsquo;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>uniq identifier of Patron</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>&#39;Simon Iong&rsquo;</td>
<td>the name of Patron</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>&ldquo;abc@example.com&rdquo;</td>
<td>the email from Patron</td>
</tr>
<tr>
<td>credit_balance</td>
<td>String</td>
<td>&#39;123.22&rsquo;</td>
<td>the current avaliable balance by Patron &amp; Establishment</td>
</tr>
<tr>
<td>trans_code</td>
<td>String</td>
<td>&ldquo;asdfw1&rdquo;</td>
<td>6 digit trans code, unique identifier for Patron</td>
</tr>
</tbody></table>

<p>Noted that for every patron, could have different credit_balance in different Establishment</p>

<h2 id="manager">Manager</h2>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>uniq identifier of Manager</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>&#39;Simon Iong&rsquo;</td>
<td>the name of Manager</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td>&#39;abc@example.com&rsquo;</td>
<td>the email from Manager</td>
</tr>
<tr>
<td>establishment_name</td>
<td>String</td>
<td>&#39;Awesome Bar&rsquo;</td>
<td>the establishment name of this Manager</td>
</tr>
</tbody></table>

<h2 id="establishment">Establishment</h2>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>uniq identifier of Establishment</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>&#39;Awesome Bar&rsquo;</td>
<td>the name of Establishment</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>&#39;123434123&rsquo;</td>
<td>the phone contact for Establishment</td>
</tr>
<tr>
<td>cash_back</td>
<td>String</td>
<td>&#39;3.5&rsquo;</td>
<td>the current cash back setting</td>
</tr>
<tr>
<td>desc</td>
<td>String</td>
<td>&#39;asdfsad&rsquo;</td>
<td>the desc for Establishment</td>
</tr>
<tr>
<td>logo_url</td>
<td>String</td>
<td>&#39;http://abc.com/logo.img&rsquo;</td>
<td>logo url</td>
</tr>
<tr>
<td>banner_url</td>
<td>String</td>
<td>&#39;http://abc.com/banner.img&rsquo;</td>
<td>logo url</td>
</tr>
<tr>
<td>address</td>
<td>Address object</td>
<td>see below</td>
<td>the address object attached to this establishment</td>
</tr>
<tr>
<td>business_hours</td>
<td>Array of Business Hour</td>
<td>see below</td>
<td>totally 7 business hour object</td>
</tr>
</tbody></table>

<h2 id="address">Address</h2>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>uniq identifier of Address</td>
</tr>
<tr>
<td>street1</td>
<td>String</td>
<td>&#39;Ma Wan MainRold&rsquo;</td>
<td>the street1 for Establishment</td>
</tr>
<tr>
<td>street2</td>
<td>String</td>
<td>&#39;Ma Wan&rsquo;</td>
<td>the street2 for Establishment</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>&#39;Hong Kong&rsquo;</td>
<td>city for Establishment</td>
</tr>
<tr>
<td>country</td>
<td>String</td>
<td>&#39;HK&rsquo;</td>
<td>country name for ISO 3166-1 standard</td>
</tr>
</tbody></table>

<h2 id="business-hour">Business Hour</h2>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>open_time</td>
<td>Integer</td>
<td>43200</td>
<td>the integer represent the seconds start from mid night, range from 0..86400</td>
</tr>
<tr>
<td>close_time</td>
<td>Integer</td>
<td>63200</td>
<td>the integer represent the seconds start from mid night, range from 0..129600, means, until 12pm next day</td>
</tr>
<tr>
<td>wday</td>
<td>Integer</td>
<td>1</td>
<td>integer represent the day in the week, 0 for sunday, 1 for monday, etc</td>
</tr>
<tr>
<td>closed</td>
<td>Boolean</td>
<td>false</td>
<td>true/false, true stands for establishment is close this day</td>
</tr>
</tbody></table>

<h2 id="transaction">Transaction</h2>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>uniq identifier of Transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;eebd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>UUID for patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ffbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>UUID for establishment</td>
</tr>
<tr>
<td>challenge_id</td>
<td>UUID</td>
<td>&#39;ffbd0c3c-404d-4ce1-9042-9baecb4ef585&rsquo;</td>
<td>UUID for challenge, can be NILL</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction, either &#39;sale&rsquo;, or &#39;credit&rsquo;, or &#39;correction&rsquo;</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;200.00&rsquo;</td>
<td>different meaning for different scenarios</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&#39;7.00&rsquo;</td>
<td>different meaning for different scenarios</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td>true means this transaction is already been deleted</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-05T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string, the timestamp that this transaction is being deleted</td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>&ldquo;ggbd0c3c-404d-4ce1-9042-9baecb4ef585&rdquo;</td>
<td>UUID of origin delete</td>
</tr>
<tr>
<td>transaction</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p>NOTED:</p>

<ul>
<li>if a transaction A is deleted by api, then a reverted transaction B is created. Both transaction A &amp; B exists in Database, transaction A is called <code class="prettyprint">origin deleted transaction</code>, transaction B is called <code class="prettyprint">reverted deleted transaction</code></li>
<li>server response json object order by tracked_at descending order.</li>
<li>Client identify <code class="prettyprint">reverted deleted transaction</code> by <code class="prettyprint">deleted_at</code>.

<ul>
<li>If transaction <code class="prettyprint">deleted_at</code> is present, means that this transaction is <code class="prettyprint">reverted deleted transaction</code>, one can reference <code class="prettyprint">origin deleted transaction</code> by <code class="prettyprint">del_transaction_id</code></li>
<li><code class="prettyprint">reverted deleted transaction</code> and <code class="prettyprint">origin deleted transaction</code> have the same <code class="prettyprint">tracked_at</code></li>
<li>If <code class="prettyprint">deleted_at</code> is populated, then <code class="prettyprint">deleted</code> should be true</li>
<li>if <code class="prettyprint">deleted_at</code> is populated, and client need to display datetime of this record somewhere, then should use <code class="prettyprint">deleted_at</code> instead of <code class="prettyprint">tracked_at</code>.</li>
</ul></li>
<li>if transaction <code class="prettyprint">deleted</code> is false, means client call <code class="prettyprint">delete transaction</code> api to delete this transaction</li>
</ul>

<h3 id="scenario-1-fully-sale-record">Scenario 1: fully sale record:</h3>

<p>sale amount is 200, cash_back setting is 3.5%, then earned credit 7.00</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcd&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction, either &#39;sale&rsquo;, or &#39;credit&rsquo;, or &#39;correction&rsquo;</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;200.00&rsquo;</td>
<td>the sale amount of this transaction</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&#39;7.00&rsquo;</td>
<td>the credit patron get from this transaction</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<h3 id="scenario-2-partially-credit-redeem">Scenario 2: Partially credit redeem:</h3>

<p>sale amount is 200, 125 credit redeemed, then sale &amp; credit record would be:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcde&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;75.00&rsquo;</td>
<td>in this case, we deduct 125 credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&#39;2.63&rsquo;</td>
<td>75 * 0.035 = 2.625</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcdf&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;credit&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;125.00&rsquo;</td>
<td>the sale amount redeem by credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&rsquo;-125.00&rsquo;</td>
<td>the credit deduct from current balance of Patron</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<h3 id="scenario-3-fully-credit-redeem">Scenario 3: Fully credit redeem:</h3>

<p>sale amount is 200, 200 credit redeemed, then there is no sale record, only credit record.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcdg&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;credit&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;200.00&rsquo;</td>
<td>the sale amount redeem by credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&rsquo;-200.00&rsquo;</td>
<td>the credit deduct from current balance of Patron</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<h3 id="scenario-4-credit-correct">Scenario 4: Credit correct:</h3>

<p>manager decide to deduct 200 credit balance for Patron.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcdh&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;correction&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;0.00&rsquo;</td>
<td>the sale amount redeem by credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&rsquo;-200.00&rsquo;</td>
<td>deduct 200 from system</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>false</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<h3 id="scenario-5-delete-full-sale-record-from-scenario-1">Scenario 5: Delete Full Sale Record from Scenario 1</h3>

<p>Original Sale transaction</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcd&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction, either &#39;sale&rsquo;, or &#39;credit&rsquo;, or &#39;correction&rsquo;</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;200.00&rsquo;</td>
<td>the sale amount of this transaction</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&#39;7.00&rsquo;</td>
<td>the credit patron get from this transaction</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<p>Reverted Sale transaction</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcd2&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction, either &#39;sale&rsquo;, or &#39;credit&rsquo;, or &#39;correction&rsquo;</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&rsquo;-200.00&rsquo;</td>
<td>the sale amount of this transaction</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&rsquo;-7.00&rsquo;</td>
<td>the credit patron get from this transaction</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-05T07:48:56.050Z&rdquo;</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>&ldquo;abcd&rdquo;</td>
<td></td>
</tr>
</tbody></table>

<h3 id="scenario-6-delete-partial-sale-record-from-scenario-2">Scenario 6: Delete Partial Sale Record from Scenario 2</h3>

<p>Original Sale Transaction</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcde&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;75.00&rsquo;</td>
<td>in this case, we deduct 125 credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&#39;2.63&rsquo;</td>
<td>75 * 0.035 = 2.625</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<p>Original Credit Transaction</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcdf&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;credit&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&#39;125.00&rsquo;</td>
<td>the sale amount redeem by credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&rsquo;-125.00&rsquo;</td>
<td>the credit deduct from current balance of Patron</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>null</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>null</td>
<td></td>
</tr>
</tbody></table>

<p>Reverted Sale transaction</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcde2&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;sale&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&rsquo;-75.00&rsquo;</td>
<td>in this case, we deduct 125 credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&rsquo;-2.63&rsquo;</td>
<td>75 * 0.035 = 2.625</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-05T07:48:56.050Z&rdquo;</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>&#39;abcde&rsquo;</td>
<td></td>
</tr>
</tbody></table>

<p>Reverted Credit transaction</p>

<table><thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>UUID</td>
<td>&#39;abcdf2&rsquo;</td>
<td>UUID of transaction</td>
</tr>
<tr>
<td>patron_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>establishment_id</td>
<td>UUID</td>
<td>&#39;ADSSDD&rsquo;</td>
<td>UUID of establishment</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>&#39;credit&rsquo;</td>
<td>type of transaction</td>
</tr>
<tr>
<td>sale_amount</td>
<td>String</td>
<td>&rsquo;-125.00&rsquo;</td>
<td>the sale amount redeem by credit</td>
</tr>
<tr>
<td>credit_amount</td>
<td>String</td>
<td>&#39;125.00&rsquo;</td>
<td>the credit deduct from current balance of Patron</td>
</tr>
<tr>
<td>tracked_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-04T07:48:56.050Z&rdquo;</td>
<td>ISO_8601 format datetime string</td>
</tr>
<tr>
<td>deleted_at</td>
<td>Datetime</td>
<td>&ldquo;2016-06-05T07:48:56.050Z&rdquo;</td>
<td></td>
</tr>
<tr>
<td>deleted</td>
<td>Boolean</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>del_transaction_id</td>
<td>UUID</td>
<td>&#39;abcdf&rsquo;</td>
<td></td>
</tr>
</tbody></table>

          <h1 id="patrons">Patrons</h1>

<h2 id="sign-up">Sign Up</h2>
<pre class="highlight shell"><code>curl <span class="s2">"http://phrenzi.com/api/patrons"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"Authorization: app_token"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
        "name": "Simon",
        "email": "abc@gmail.com",
        "password": "password",
        "password_confirmation": "password",
        "confirm_success_url": "phrenzi://"
        }'</span>
</code></pre>

<blockquote>
<p>if success, the above command returns HTTP Status Code <code class="prettyprint">200</code> with following json objects:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"patron"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"37f335c5-a88c-41a3-a643-fba688c72897"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Simon"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc@example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8cc897"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, the above command returns HTTP Status Code <code class="prettyprint">422</code> with following json objects:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"already in use"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"full_messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Email already in use"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint try to register a account for Patron, and need App Token authenticate.</p>

<ul>
<li>if success, it will return HTTP Status Code <code class="prettyprint">200</code> with <code class="prettyprint">Patron</code> json object</li>
<li>if failed, it will return HTTP Status Code <code class="prettyprint">422</code>, and with <code class="prettyprint">errors</code> json message</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://phrenzi.com/api/patrons</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td>the name of patron</td>
</tr>
<tr>
<td>email</td>
<td>the email of patron</td>
</tr>
<tr>
<td>password</td>
<td>the password of patron account</td>
</tr>
<tr>
<td>password_confirmation</td>
<td>confirm password again</td>
</tr>
<tr>
<td>confirm_success_url</td>
<td>the url after confirmation link is click</td>
</tr>
</tbody></table>

<h2 id="sign-in">Sign In</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patrons/sign_in"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"Authorization: app_token"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
        "email": "abc@gmail.com",
        "password": "password" }'</span>
</code></pre>

<blockquote>
<p>if success, the above command returns <code class="prettyprint">Patron</code> object with <code class="prettyprint">200</code> status code, and structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"patron"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"288f4f0f-da30-45c4-a531-c0a804628395"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Simon"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"76efd7"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, the above command returns status code <code class="prettyprint">401</code> and json structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Invalid login credentials. Please try again."</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if patron is not confirmed yet, return status code <code class="prettyprint">401</code> and json like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"A confirmation email was sent to your account at 'abc@gmail.com'. You must follow the instructions in the email before your account can be activated"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint try to authenticate Patron, and need App Token authenticate.</p>

<ul>
<li>if success, it will return <code class="prettyprint">Patron</code> object with HTTP Status Code <code class="prettyprint">200</code>, and client can retrive
auth header from reponse to consuming next request that need authentication.</li>
<li>if failed to authenticate, it will return HTTP Status Code <code class="prettyprint">401</code> with <code class="prettyprint">errors</code> message.</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://example.com/api/patrons/sign_in</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>the email of patron account</td>
</tr>
<tr>
<td>password</td>
<td>the password of patron account</td>
</tr>
</tbody></table>

<h2 id="sign-out">Sign Out</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patrons/sign_out"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span>
  -X DELETE
</code></pre>

<blockquote>
<p>if success, the above command returns status code <code class="prettyprint">200</code>, and json object like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, the above command returns status code <code class="prettyprint">404</code>, and errors json like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"User was not found or was not logged in."</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>this endpoint need <code class="prettyprint">Auth Header</code> to authenticate patron,
you are going to get it from Patron <code class="prettyprint">Sign In</code> api request
or other subsequence request that need authentication.</p>

<ul>
<li>if success, it will return HTTP Status Code <code class="prettyprint">200</code></li>
<li>if failed to authenticate, it will return HTTP Status Code <code class="prettyprint">404</code> with <code class="prettyprint">errors</code> message.</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE http://example.com/api/patrons/sign_out</code></p>

<h2 id="confirmation-patron">Confirmation Patron</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patrons/confirmation"</span> <span class="se">\</span>
  -X GET
  -d <span class="s1">'{
    "confirmation_token": "abcasdfasd",
    "redirect_url": "phrenzi://",
    "config": "default"
    }'</span>
</code></pre>

<blockquote>
<p>if success, it will redirect to the <code class="prettyprint">redirect_url</code> specify in this api</p>

<p>if failed, it will raise an exception ActionController::RoutingError</p>
</blockquote>

<p>during sign up procedure of patron ( client call Patron sign up API ),
server will sent out a confirmation email to Patron&rsquo;s mailbox,
patron will need to click a link in that email,
there&rsquo;s a generated confirmation_token in there, which will be use to call
in this endpoint.</p>

<aside class="warning">Client don&rsquo;t need to call this API.</aside>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://example.com/api/patrons/confirmation</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>confirmation_token</td>
<td>the confirmation token for patron</td>
</tr>
<tr>
<td>redirect_url</td>
<td>the params is pass-in from patron sign up API</td>
</tr>
<tr>
<td>config</td>
<td>the config object, which is <code class="prettyprint">default</code></td>
</tr>
</tbody></table>

<h2 id="request-reset-password">Request Reset Password</h2>
<pre class="highlight shell"><code>curl <span class="s2">"http://example.com/api/patrons/password"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"Authorization: app_token"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
        "email": "abc@gmail.com" }'</span>
        <span class="s2">"redirect_url"</span>: <span class="s2">"phrenzi://"</span> <span class="o">}</span><span class="s1">'
</span></code></pre>

<blockquote>
<p>if success, return HTTP Status Code <code class="prettyprint">200</code> without following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An email has been sent to 'abc@gmail.com' containing instructions for resetting your password."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if email not found, return HTTP Status Code `404, with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Unable to find user with email 'abc@gmail.com.'"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if email is missing, return HTTP Status Code <code class="prettyprint">401</code>, with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"You must provide an email address."</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if redirect_url is missing, return HTTP Status Code <code class="prettyprint">401</code>, with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Missing redirect URL."</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This api need App Token authenticated and is used while Patron forget password, and after this api is invoked and is success, a email
will trigger and sent to Patron&rsquo;s registered email.</p>

<ul>
<li>if success, it will return HTTP Status Code <code class="prettyprint">200</code> without json object</li>
<li>if email is missing, it will return HTTP Status Code <code class="prettyprint">401</code></li>
<li>if redirect_url is missing, it will return HTTP Status Code <code class="prettyprint">401</code></li>
<li>if email is not found in server, it will return HTTP Status Code <code class="prettyprint">404</code></li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://phrenzi.com/api/patrons/password</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>the email of patron</td>
</tr>
<tr>
<td>redirect_url</td>
<td>the url that is used within reset password email to redirect back to app</td>
</tr>
</tbody></table>

<h2 id="password-reset-link">Password Reset Link</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patrons/password/edit"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -X GET <span class="se">\</span>
  -d <span class="s1">'{
    "reset_password_token": "abcasdfasd",
    "redirect_url": "phrenzi://"
    }'</span>
</code></pre>

<blockquote>
<p>if success, it will redirect to the <code class="prettyprint">redirect_url</code> specify in this api</p>

<p>if failed, it will raise an exception ActionController::RoutingError</p>
</blockquote>

<p>during password reset procedure of patron ( client call Patron request password reset API ), server
will sent out a password reset email to Patron&rsquo;s mailbox,
patron will need to click a link in that email,
which will trigger this call if Patron click that link.
If every thing is fine, Patron will redirect to app,
with <code class="prettyprint">auth header</code> in a request, then App can
retrieve <code class="prettyprint">auth header</code> from that redirect request.</p>

<aside class="warning">Client don&rsquo;t need to call this API.</aside>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://phrenzi.com/api/patrons/password/edit</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>reset_password_token</td>
<td>reset password token</td>
</tr>
<tr>
<td>redirect_url</td>
<td>a link to redirect back after success operation</td>
</tr>
</tbody></table>

<h2 id="update-password">Update Password</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patrons/password"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X PATCH <span class="se">\</span>
  -d <span class="s1">'{
    "password": "new_password",
    "password_confirmation": "new_password"
    }'</span>
</code></pre>

<blockquote>
<p>if success, it will response with http status code <code class="prettyprint">200</code>, and with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Your password has been successfully updated."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, for example, password mismatch, response with http status code <code class="prettyprint">422</code>,
and with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"password_confirmation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"doesn't match Password"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"full_messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Password confirmation doesn't match Password"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if not authenticate, response with <code class="prettyprint">401</code> and following json object,</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Unauthorized"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This api endpoint need Patron authenticated.</p>

<ul>
<li>if success, response with http status code <code class="prettyprint">200</code></li>
<li>if authenticate failed, response with http status code <code class="prettyprint">401</code></li>
<li>if validation failed, for example, passsord mismatch, response with http status code <code class="prettyprint">422</code></li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">PATCH http://phrenzi.com/api/patrons/password</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>password</td>
<td>the new password of patron</td>
</tr>
<tr>
<td>password_confirmation</td>
<td>confirm again the new password</td>
</tr>
</tbody></table>

          <h1 id="managers">Managers</h1>

<h2 id="sign-in">Sign In</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/managers/sign_in"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"Authorization: app_token"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
        "email": "abc@gmail.com",
        "password": "password" }'</span>
</code></pre>

<blockquote>
<p>if success, the above command returns <code class="prettyprint">Manager</code> object with <code class="prettyprint">200</code> status code, and structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"manager"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6b586aeb-a53d-476a-9435-659ed9547e6e"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"establishment_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Awesome Bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, the above command returns status code <code class="prettyprint">401</code> and json structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Invalid login credentials. Please try again."</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if manager is not confirmed yet, return status code <code class="prettyprint">401</code> and json like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"A confirmation email was sent to your account at 'abc@gmail.com'. You must follow the instructions in the email before your account can be activated"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint try to authenticate Manager, and need App Token authenticated.</p>

<ul>
<li>if success, it will return <code class="prettyprint">Manager</code> object with HTTP Status Code <code class="prettyprint">200</code>, and client can retrive
auth header from reponse to consuming next request that need authentication.</li>
<li>if failed to authenticate, it will return HTTP Status Code <code class="prettyprint">401</code> with <code class="prettyprint">errors</code> message.</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://example.com/api/managers/sign_in</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>the email of manager account</td>
</tr>
<tr>
<td>password</td>
<td>the password of manager account</td>
</tr>
</tbody></table>

<h2 id="sign-out">Sign Out</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/managers/sign_out"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span>
  -X DELETE
</code></pre>

<blockquote>
<p>if success, the above command returns status code <code class="prettyprint">200</code>, and json object like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, the above command returns status code <code class="prettyprint">404</code>, and errors json like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"User was not found or was not logged in."</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>this endpoint need <code class="prettyprint">Auth Header</code> to authenticate manager,
you are going to get it from Manager <code class="prettyprint">Sign In</code> api request
or other subsequence request that need authentication.</p>

<ul>
<li>if success, it will return HTTP Status Code <code class="prettyprint">200</code></li>
<li>if failed to authenticate, it will return HTTP Status Code <code class="prettyprint">404</code> with <code class="prettyprint">errors</code> message.</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE http://example.com/api/managers/sign_out</code></p>

          <h1 id="patronapp-profile-image">PatronApp / Profile Image</h1>

<h2 id="pre-sign-url">pre-sign url</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patron_app/patron_profile/cache/presign"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="nt">"url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://phrenzistaging.s3-ap-southeast-1.amazonaws.com"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"fields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"policy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJleHBpcmF0aW9uIjoiMjAxNi0xMi0wOVQxMDoyNzozMVoiLCJjb25kaXRpb25zIjpbeyJidWNrZXQiOiJwaHJlbnppc3RhZ2luZyJ9LHsia2V5IjoiY2FjaGUvMmE3OGI3MWI2MGYwMmZjMDk3YzFhYWM1ZTA0MDkxMzgifSx7IngtYW16LWNyZWRlbnRpYWwiOiJBS0lBSlhNM1U3QU02STNPRTM2QS8yMDE2MTIwOS9hcC1zb3V0aGVhc3QtMS9zMy9hd3M0X3JlcXVlc3QifSx7IngtYW16LWFsZ29yaXRobSI6IkFXUzQtSE1BQy1TSEEyNTYifSx7IngtYW16LWRhdGUiOiIyMDE2MTIwOVQwOTI3MzFaIn1dfQ=="</span><span class="p">,</span><span class="w">
      </span><span class="nt">"x-amz-algorithm"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS4-HMAC-SHA256"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"key"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cache/2a78b71b60f02fc097c1aac5e0409138"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"x-amz-signature"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"52956151623087d2a4997462c90055d61e51de3b1a5b8d89f826f1769da3894f"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"x-amz-date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"20161209T092731Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"x-amz-credential"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"AKIAJXM3U7AM6I3OE36A/20161209/ap-southeast-1/s3/aws4_request"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint retrieves pre-sign url for upload image into s3</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://example.com/api/patron_app/patron_profiile/cache/presign</code></p>

<p>After you retrive the presign url, you could be able to make a post request to presign url with the fields this end-point provided. Then you could be able to retrieve an id from S3. Please construct a json object with this id, and this object will going to be used in next API call to create the actual profile image in Phrenzi</p>

<p>For more detail, please visit shrine&rsquo;s plugin <a href="http://shrinerb.com/rdoc/files/doc/direct_s3_md.html">direct_upload</a></p>

<h2 id="create-patron-profile">create patron profile</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patron_app/patron_profile"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"Authorization: app_token"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
        "profile": {
          "id": "349234854924394", # requied
          "storage": "cache", # requied
          "metadata": {
            "size": 45461, # optional
            "filename": "foo.jpg", # optional
            "mime_type": "image/jpeg", # optional
          }
        }
      }'</span>
</code></pre>

          <h1 id="patronapp-establishments">PatronApp / Establishments</h1>

<h2 id="get-all-establishments">get all establishments</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patron_app/establishments"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"establishments"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c3d12f1a-1f0e-4ade-ae6a-49660db2b2ea"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Establishment1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"612345671"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example description"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"logo_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://abc.com/uploads/establishment/logo/c3d12f1a-1f0e-4ade-ae6a-49660db2b2ea/thumb_image.jpeg"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"banner_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://abc.com/uploads/establishment/banner/c3d12f1a-1f0e-4ade-ae6a-49660db2b2ea/thumb_image.jpeg"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"active_booster_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20000.0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0c9d3e1c-9499-472c-8f87-9acd0f8866d2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Establishment2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"612345672"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example description"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"logo_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://abc.com/uploads/establishment/logo/0c9d3e1c-9499-472c-8f87-9acd0f8866d2/thumb_image.jpeg"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"banner_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://abc.com/uploads/establishment/banner/0c9d3e1c-9499-472c-8f87-9acd0f8866d2/thumb_image.jpeg"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"active_booster_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200.0"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint retrieves all establishments</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://example.com/api/patron_app/establishments</code></p>

<aside class="warning">We will add pagination parameter later, but for this phase, we just skip it.</aside>

<h2 id="get-establishment">get establishment</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patron_app/establishments/c3d12f1a-1f0e-4ade-ae6a-49660db2b2ea"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"establishment"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"610ce5ee-8ce2-4ad2-9296-3e2bd6ec539a"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Establishment1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"612345671"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"desc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example description"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"logo_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://abc.com/uploads/establishment/logo/e1c3c3b9e1bb587672ed14663c233d2a.jpeg"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"banner_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://abc.com/uploads/establishment/banner/cf2731b3f037e081fee8230378290b62.jpeg"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"active_booster_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"credit_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54f27047-8a98-4304-b7bc-43b2f855a582"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"street1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MyString"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"street2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MyString"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MyString"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MyString"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"business_hours"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"wday"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
        </span><span class="nt">"open_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">39600</span><span class="p">,</span><span class="w">
        </span><span class="nt">"close_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span><span class="w">
        </span><span class="nt">"closed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"current_challenge"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-12-06T16:00:00.000Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"end_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-12-06T16:00:00.000Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"winner_percentage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"prize_percentage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"total_sales"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ranking"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f9128d9c-a60c-471d-8e22-761bc0a0a785"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patron2"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"join_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-12-07T12:30:01.496Z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"point_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20.0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"ranking"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nt">"prize"</span><span class="p">:</span><span class="w"> </span><span class="s2">"500"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8d7c84fd-c6d1-4c02-b7b6-e5a3d6eebacd"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patron1"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"join_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-12-07T12:30:01.469Z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"point_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"ranking"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"prize"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"current_boosters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20ac2155-b5f6-440a-aedc-c1c4b0cae8f6"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"actived"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"booster_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"check_in"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c74cc563-2119-4fc5-ae86-de4d77b2a25b"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"actived"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"booster_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invitation"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint retrieves establishment detail</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://example.com/api/patron_app/establishments/c3d12f1a-1f0e-4ade-ae6a-49660db2b2ea</code></p>

          <h1 id="patronapp-transactions">PatronApp / Transactions</h1>

<h2 id="get-all-transactions-by-establishment_id">get all transactions by establishment_id</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/patron_app/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -d <span class="s1">'{
    "establishment_id": "a66d32c1-b50b-427e-8954-ec945e402f6d"
    }'</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b80221a1-3f91-4979-b14f-f6d477b90561"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a66d32c1-b50b-427e-8954-ec945e402f6d"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"62ada2ca5e"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:38:55.455Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a494ed0a-d7f9-4f6a-8dec-3ccc05fddc5e"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a66d32c1-b50b-427e-8954-ec945e402f6d"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"f366f03f71"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:38:55.455Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"current_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"next_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"prev_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"total_pages"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint authenticate by patron authenticate, and retrieves all transactions for specific
patron and for specific establishment</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://example.com/api/patron_app/establishments</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>establishment_id</td>
<td>Y</td>
<td>establishment_id that transactions belongs to</td>
</tr>
<tr>
<td>page</td>
<td>N</td>
<td>the page results of all transactions</td>
</tr>
<tr>
<td>per_page</td>
<td>N</td>
<td>the number of transaction record return per page by api, default to be 20</td>
</tr>
</tbody></table>

          <h1 id="management-patrons">Management / Patrons</h1>

<h2 id="get-all-patrons">Get all patrons</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/patrons"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
</code></pre>

<blockquote>
<p>The above command returns array of <code class="prettyprint">Patron</code> object like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"patrons"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8d3d7ecd-585d-4f2f-ad21-1b457e062681"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patron1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patron1@gmail.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.23"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"52553b"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fcbdd18f-e5ea-4368-8cf4-2e688e604a40"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patron2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patron2@gmail.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25e8ac"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint require manager authentication, and retrieves all patrons.</p>

<p>Noted that credit_balance returned from patron object is for manager&rsquo;s establishment,
the <code class="prettyprint">credit_balance</code> return from different manager authenticated should be differernt.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://phrenzi.com/api/management/patrons</code></p>

<h2 id="get-patron">Get patron</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/patrons/ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
</code></pre>

<blockquote>
<p>The above command return <code class="prettyprint">Patron</code> object like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"patron"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Patron1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"patron1@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"credit_balance"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.23"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"519665"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint require manager authentication, and retrieves patron object.</p>

<p>Noted that credit_balance returned from patron object is for manager&rsquo;s establishment,
the <code class="prettyprint">credit_balance</code> return from different manager authenticated should be differernt.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://phrenzi.com/api/management/patrons/ddbd0c3c-404d-4ce1-9042-9baecb4ef585</code></p>

          <h1 id="management-transactions">Management / Transactions</h1>

<h2 id="get-all-transactions-by-patron_id-for-current-establishment">Get all transactions by patron_id for current establishment</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -d <span class="s1">'{
    "patron_id": "ddbd0c3c-404d-4ce1-9042-9baecb4ef585"
    }'</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bf77e8f9-c01d-4dc1-9fba-d79427f1cd8e"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e405f87e-447b-4308-a39f-1e6505ba5503"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"621f3849e5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:22:17.005Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4e47edfd-fd56-4ceb-ba12-b9e233da8436"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e405f87e-447b-4308-a39f-1e6505ba5503"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c76f93d48b"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:22:17.005Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"current_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"next_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"prev_page"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nt">"total_pages"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint need manager authentication, and retrieves transaction records by establishment by patron</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://example.com/api/management/transactions</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Requred?</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>patron_id</td>
<td>Y</td>
<td>only list transactions that belongs to patron</td>
</tr>
<tr>
<td>page</td>
<td>N</td>
<td>the page results of all transactions, default to be page 1</td>
</tr>
<tr>
<td>per_page</td>
<td>N</td>
<td>the number of transaction record return per page by api, default to be 20</td>
</tr>
</tbody></table>

<h2 id="create-transaction">Create Transaction</h2>

<blockquote>
<p>For creating fullay sales transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
    "trans_type": "sale",
    "patron_id": "ddbd0c3c-404d-4ce1-9042-9baecb4ef585",
    "sales_amount": 200.00,
    "credit_amount": 0.0
    }'</span>
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fc3dc0d4-5500-4727-a817-b63e92b8303d"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"baa7bd5c-2daf-44b4-8abb-9918b2001ca3"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5305ec72be"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:14:38.953Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>For creating partially sales transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
    "trans_type": "sale",
    "patron_id": "ddbd0c3c-404d-4ce1-9042-9baecb4ef585",
    "sales_amount": 200.00,
    "credit_amount": -125.0
    }'</span>
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"67c622ae-8048-4ccb-983c-a5e467b8d1ba"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"86aef2ae-3651-4dad-90ad-303a8f476638"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"75.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.63"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b9dd87d694"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ff84acbaaf"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:16:04.090Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b9321494-9096-479d-ad74-2c00f1762ac2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"86aef2ae-3651-4dad-90ad-303a8f476638"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"credit"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"125.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-125.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9afa1212a9"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ff84acbaaf"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:16:04.090Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>For creating fully credit redeem transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
    "type": "sale",
    "patron_id": "ddbd0c3c-404d-4ce1-9042-9baecb4ef585",
    "sales_amount": 200.00,
    "credit_amount": -200.0
    }'</span>
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a2b26425-90da-4273-a57a-a8f5a0d4981a"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c01057e7-6e17-4395-9230-eb5204a6dd5a"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"credit"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41c7eed125"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:17:46.515Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>For creating correction credit transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
    "type": "correction",
    "patron_id": "ddbd0c3c-404d-4ce1-9042-9baecb4ef585",
    "sales_amount": 0.0,
    "credit_amount": -200.0
    }'</span>
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"371051f9-0214-4ff3-bc82-6cea5b96f9f8"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a4999183-fa78-4191-8402-1538eb747c23"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"correction"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1a3f96b921"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:18:36.521Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Error Scenarios</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X POST <span class="se">\</span>
  -d <span class="s1">'{
    "type": "correction",
    "patron_id": "ddbd0c3c-404d-4ce1-9042-9baecb4ef585",
    "sales_amount": 0.0,
    "credit_amount": -200.0
    }'</span>
</code></pre>

<blockquote>
<p>if establishment is not open, the above command returns status code 406, and errors json like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Current Establishment is not opened"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if current credit balance is not enough, then return status code 406, and errors json like this:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Balance not enough"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if input validation is failed</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"is not included in the list"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint required manager authentication, and create transaction records.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://example.com/api/management/transactions</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>trans_type</td>
<td>Y</td>
<td>&lsquo;sales&rsquo;/&#39;correction&rsquo;</td>
</tr>
<tr>
<td>sales_amount</td>
<td>Y</td>
<td>the sale amount</td>
</tr>
<tr>
<td>credit_amount</td>
<td>Y</td>
<td>the credit amount</td>
</tr>
<tr>
<td>patron_id</td>
<td>Y</td>
<td>UUID of patron</td>
</tr>
<tr>
<td>cash_back</td>
<td>N</td>
<td>cash back for one time use case</td>
</tr>
<tr>
<td>password</td>
<td>N</td>
<td>if cash_back is present, then password of patron must provided</td>
</tr>
</tbody></table>

<h3 id="query-exmaple">Query Exmaple:</h3>

<p>normal sale record, without credit redeem:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>trans_type</td>
<td>&#39;sale&rsquo;</td>
</tr>
<tr>
<td>patron_id</td>
<td>&ldquo;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rdquo;</td>
</tr>
<tr>
<td>sales_amount</td>
<td>200.0</td>
</tr>
<tr>
<td>credit_amount</td>
<td>0.0</td>
</tr>
</tbody></table>

<p>sale record, with partially credit redeem ( 200 sale amount, but with 125 credit redeem , so patron just need to pay 75.0 ):</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>trans_type</td>
<td>&#39;sale&rsquo;</td>
</tr>
<tr>
<td>patron_id</td>
<td>&ldquo;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rdquo;</td>
</tr>
<tr>
<td>sales_amount</td>
<td>200.0</td>
</tr>
<tr>
<td>credit_amount</td>
<td>-125.0</td>
</tr>
</tbody></table>

<p>sale record, fully credit redeem ( 200 sale amount, 200 credit redeem, so patron do not need to pay):</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>trans_type</td>
<td>&#39;sale&rsquo;</td>
</tr>
<tr>
<td>patron_id</td>
<td>&ldquo;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rdquo;</td>
</tr>
<tr>
<td>sales_amount</td>
<td>200.0</td>
</tr>
<tr>
<td>credit_amount</td>
<td>-200.0</td>
</tr>
</tbody></table>

<p>positive correction record:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>trans_type</td>
<td>&#39;correction&rsquo;</td>
</tr>
<tr>
<td>patron_id</td>
<td>&ldquo;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rdquo;</td>
</tr>
<tr>
<td>sales_amount</td>
<td>0.0</td>
</tr>
<tr>
<td>credit_amount</td>
<td>125.0</td>
</tr>
</tbody></table>

<p>negative correction record:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>trans_type</td>
<td>&#39;correction&rsquo;</td>
</tr>
<tr>
<td>patron_id</td>
<td>&ldquo;ddbd0c3c-404d-4ce1-9042-9baecb4ef585&rdquo;</td>
</tr>
<tr>
<td>sales_amount</td>
<td>0.0</td>
</tr>
<tr>
<td>credit_amount</td>
<td>-125.0</td>
</tr>
</tbody></table>

<h2 id="delete-transaction">Delete Transaction</h2>

<blockquote>
<p>For delete fullay sales transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions/ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X DELETE
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3cf13c1d-a1b8-4258-9ae0-4239cd5c81df"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c801514d-8063-4a79-82cc-686747165a85"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"af84f935-9ab5-41f9-abe5-37a06a6dfa36"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-100.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"362b2882f2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:36:32.563Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:36:32.563Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>For delete partially sales transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions/ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X DELETE
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"db2a88e1-072b-42ef-a9b9-0af3cd2977ac"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42d7d7c1-c8f6-4444-9472-a34322c091a9"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24b0345f-d06b-4fed-b1c6-50bd424028b0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sales"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-75.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-2.63"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"60c1bb42e9"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abcdefgfhi"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:39:07.321Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:36:32.563Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="p">,</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adc33168-1207-4370-9852-da6563a890a5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42d7d7c1-c8f6-4444-9472-a34322c091a9"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24b0345f-d06b-4fed-b1c6-50bd424028b0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"credit"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-125.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"125.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3285af74bb"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abcdefgfhi"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:39:07.321Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6a7b9c7f-f32e-4a9f-905e-057cd4acd9cb"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:36:32.563Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>For delete fully credit redeem transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions/ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X DELETE
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2f8cb908-2997-417a-941c-9ccb15da0a29"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b4e18a28-9ccc-4e47-bd34-3241998410b1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"744275ee-714d-40eb-8657-880725bbeb9b"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"credit"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6e2dd918c6"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:41:33.685Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:36:32.563Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>For delete correction credit transaction</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions/ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X DELETE
</code></pre>

<blockquote>
<p>The above command returns HTML status code 200 OK if success and json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"transactions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10d1a032-ca48-4d08-b078-5c74e76fb6cc"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"patron_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a540cb87-a662-4b89-b1f0-47e4c62eb3c2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"establishment_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4020f704-6ea8-4323-85bf-0a5d9b04140a"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"challenge_id"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"correction"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"sales_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-0.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"credit_amount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-200.0"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"trans_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eb7b042ac2"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"group_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nt">"tracked_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-26T13:42:53.904Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"del_transaction_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ddbd0c3c-404d-4ce1-9042-9baecb4ef585"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-27T13:36:32.563Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"deleted"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="err">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>While specify delete transaction is invalid, or fake, or not belongs to current establishment</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/transactions/this-is-a-fake-id"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -H <span class="s2">"access-token: token"</span> <span class="se">\</span>
  -H <span class="s2">"token-type: Bearer"</span> <span class="se">\</span>
  -H <span class="s2">"client: u4N6u_toFnoDR1o318uOVA"</span> <span class="se">\</span>
  -H <span class="s2">"expiry: 1466692376"</span> <span class="se">\</span>
  -H <span class="s2">"uid: abc@example.com"</span> <span class="se">\</span>
  -X DELETE
</code></pre>

<blockquote>
<p>The above command returns HTML status code 406 and following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"Transaction is invalid"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint required manager authentication, and delete transaction records.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE http://example.com/api/management/transactions/#{transaction_id}</code></p>

          <h1 id="management-settings">Management / Settings</h1>

<h2 id="get-cash-back">Get cash back</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/settings/cash_back"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
</code></pre>

<blockquote>
<p>if success, return http status code 200 with following json object:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"setting"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.5"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, for example, unauthorized, then return http status code 401 with following json object:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"Authorized users only."</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint require <code class="prettyprint">manager authenticate</code></p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://phrenzi.com/api/management/cash_back</code></p>

<h2 id="update-cash-back">Update cash back</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/settings/cash_back"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -X PATCH <span class="se">\</span>
  -d <span class="s1">'{
    "password": "current_password",
    "cash_back": 4.5
    }'</span>
</code></pre>

<blockquote>
<p>if success, returns HTML status code 200 OK, with following object:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"setting"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"cash_back"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4.5"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if unauthorize, returns HTML status code 401, with following object:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"Authorized users only."</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if password is invalid, return HTML status code 406, with following object:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"Invalid Password"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint require manager authenticate, and update cash_back for current establishment.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">PATCH http://phrenzi.com/api/management/cash_back</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>cash_back</td>
<td>the cash_back to update, within 0 and 100</td>
</tr>
<tr>
<td>password</td>
<td>the current password for current manager</td>
</tr>
</tbody></table>

<h2 id="update-password">Update Password</h2>
<pre class="highlight shell"><code>curl <span class="s2">"https://phrenzi.com/api/management/settings/passwords"</span> <span class="se">\</span>
  -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
  -X PATCH <span class="se">\</span>
  -d <span class="s1">'{
    "current_password": "current_password",
    "password": "new_password",
    "password_confirmation": "new_password"
    }'</span>
</code></pre>

<blockquote>
<p>If success, return http status code <code class="prettyprint">200</code> with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"manager"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2544a3af-cda6-4a0d-b760-17e43e1cc165"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"manager1@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"establishment_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Awesome Bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>if failed, return http status code <code class="prettyprint">422</code>, with following json object</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"current_password"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"is invalid"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nt">"password_confirmation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"doesn't match Password"</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint require <code class="prettyprint">manager_token</code>, and update current password for current manager.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">PATCH http://phrenzi.com/api/management/settings/update_password</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>current_password</td>
<td>the current password for current manager</td>
</tr>
<tr>
<td>password</td>
<td>the new password for current manager</td>
</tr>
<tr>
<td>password_confirmation</td>
<td>confirmation for the new password</td>
</tr>
</tbody></table>

          <h1 id="errors">Errors</h1>

<p>The Phrenzi API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Your request sucks</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The resource requested is hidden for administrators only</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified resource could not be found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; You tried to access a resource with an invalid method</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>410</td>
<td>Gone &ndash; The resource requested has been removed from our servers</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessable Entity, this happend while request params have validation errors</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You&rsquo;re requesting too many resources! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
